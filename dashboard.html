<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤šæ©Ÿèƒ½ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ - èŒœ-ã‚ã‹ã­-</title>
    <link rel="stylesheet" href="style.css">
    <script defer src="dashboard.js"></script>
    <link rel="icon" type="image/png" href="images/favicon.png">
</head>
<body>
    <header>
        <div class="logo">èŒœ-ã‚ã‹ã­-</div>
        <nav>
            <ul>
                <li><a href="index">ãƒ›ãƒ¼ãƒ </a></li>
                <li><a href="terms">åˆ©ç”¨è¦ç´„</a></li>
                <li><a href="privacy">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a></li>
                <li><a href="docs">ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a></li>
            </ul>
        </nav>
        <div id="user-profile">
            <button id="login-btn">ãƒ­ã‚°ã‚¤ãƒ³</button>
            <button id="logout-btn" style="display: none;">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
            <img id="user-avatar" src="" alt="User Avatar" style="display: none;">
        </div>
    </header>

    <main>
        <h1>å¤šæ©Ÿèƒ½ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
        <p>ç®¡ç†ã—ã¦ã„ã‚‹ã‚µãƒ¼ãƒãƒ¼ã‚’é¸æŠã—ã¦è©³ç´°ã‚’ç¢ºèªã§ãã¾ã™ã€‚</p>

        <input type="text" id="server-search" placeholder="ã‚µãƒ¼ãƒãƒ¼åã§æ¤œç´¢..." />

        <div id="server-list" class="server-grid">
            <p>èª­ã¿è¾¼ã¿ä¸­...</p>
        </div>

        <section id="server-detail" style="display:none">
            <h2>ã‚µãƒ¼ãƒãƒ¼çµ±è¨ˆ: <span id="server-name"></span></h2>
            <p><strong>ID:</strong> <span id="server-id"></span></p>
            <p><strong>ãƒ¡ãƒ³ãƒãƒ¼æ•°:</strong> <span id="server-members"></span></p>
            <p><strong>ãƒãƒ£ãƒ³ãƒãƒ«æ•°:</strong> <span id="server-channels"></span></p>
            <p><strong>Botå°å…¥æ¸ˆã¿:</strong> <span id="server-bot"></span></p>
        </section>
    </main>

    <footer>
        <p>&copy; 2024-2025 akane-team</p>
    </footer>

    <script>
    document.addEventListener("DOMContentLoaded", async () => {
        const loginBtn = document.getElementById("login-btn");
        const logoutBtn = document.getElementById("logout-btn");
        const userAvatar = document.getElementById("user-avatar");

        async function fetchUser() {
            const res = await fetch("https://akane-quin.glitch.me/api/user", { credentials: "include" });
            if (!res.ok) return null;
            return await res.json();
        }

        async function fetchServers() {
            const res = await fetch("https://akane-quin.glitch.me/api/servers", { credentials: "include" });
            if (!res.ok) return null;
            return await res.json();
        }

        loginBtn.addEventListener("click", () => {
            window.location.href = "https://akane-quin.glitch.me/auth/discord";
        });

        logoutBtn.addEventListener("click", async () => {
            await fetch("https://akane-quin.glitch.me/logout", { credentials: "include" });
            location.reload();
        });

        const user = await fetchUser();
        if (user) {
            loginBtn.style.display = "none";
            logoutBtn.style.display = "inline-block";
            userAvatar.src = `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png`;
            userAvatar.style.display = "inline-block";
        }

        const serverList = document.getElementById("server-list");
        const servers = await fetchServers();
        let allServers = [];

        function renderServers(serversToShow) {
            serverList.innerHTML = "";
            serversToShow.forEach(server => {
                const serverCard = document.createElement("div");
                serverCard.className = "server-card";
                serverCard.innerHTML = `
                    <img src="${server.icon || 'images/default-icon.png'}" alt="${server.name}" />
                    <h3>${server.name}</h3>
                    <p>ğŸ‘¥ ${server.memberCount || '?'} / ğŸ“º ${server.channelCount || '?'}</p>
                    ${server.botInServer ? `<button onclick="viewServer('${server.id}')">è©³ç´°ã‚’è¦‹ã‚‹</button>` : `<button onclick="inviteBot('${server.id}')">Botã‚’å°å…¥</button>`}
                `;
                serverList.appendChild(serverCard);
            });
        }

        if (servers && servers.length > 0) {
            allServers = servers;
            renderServers(allServers);
        } else {
            serverList.innerHTML = "<p>ç®¡ç†è€…æ¨©é™ã®ã‚ã‚‹ã‚µãƒ¼ãƒãƒ¼ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>";
        }

        document.getElementById("server-search").addEventListener("input", e => {
            const query = e.target.value.toLowerCase();
            const filtered = allServers.filter(s => s.name.toLowerCase().includes(query));
            renderServers(filtered);
        });
    });

    function viewServer(serverId) {
        const detailSection = document.getElementById("server-detail");
        const server = allServers.find(s => s.id === serverId);
        if (!server) return;

        document.getElementById("server-name").textContent = server.name;
        document.getElementById("server-id").textContent = server.id;
        document.getElementById("server-members").textContent = server.memberCount || "ä¸æ˜";
        document.getElementById("server-channels").textContent = server.channelCount || "ä¸æ˜";
        document.getElementById("server-bot").textContent = server.botInServer ? "ã¯ã„" : "ã„ã„ãˆ";

        detailSection.style.display = "block";
        detailSection.scrollIntoView({ behavior: "smooth" });
    }

    function inviteBot(serverId) {
        window.location.href = `https://discord.com/oauth2/authorize?client_id=1201010163356799036&scope=bot&permissions=8&guild_id=${serverId}`;
    }
    </script>
</body>
</html>
